<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - CONJOAAD</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='login.css') }}">
</head>
<body>
    <div class="login-page">
        <div class="login-container">

            <div class="logos">
                <img src="{{ url_for('static', filename='images/logo-ad.PNG') }}" alt="Assembleia de Deus">
                <img src="{{ url_for('static', filename='images/logo-conjoaad.png') }}" alt="CONJOAAD">
            </div>

            <h1><span>CONJOAAD 9ª REGIÃO</span></h1>

            <p class="subtitle">Mídia 9ª Região</p>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div id="login-alert" class="login-alert {{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
                {% endwith %}


            <form method="post" action="/">
                <label>Usuário</label>
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <input type="text" name="username" required>

                <label>Senha</label>
                <input type="password" name="password" required>

                <button id="btn-login" type="submit">Entrar</button>

                <p id="login-msg" style="display:none; color:#f39c12; margin-top:10px;"></p>
            </form>

        </div>
    </div>
    <script nonce="{{ g.csp_nonce }}">
    (() => {
        /* ===============================
            1️⃣ Fade automático do alerta
            =============================== */
        const alertBox = document.getElementById("login-alert");

        if (alertBox) {
            setTimeout(() => {
            alertBox.style.opacity = "0";
            alertBox.style.transition = "opacity 0.5s ease";

            setTimeout(() => {
                alertBox.remove();
            }, 500);
            }, 2000); // ⏱️ mantém seu temporizador visual
        }

        /* ===============================
            2️⃣ Controle de tentativas (UX)
            =============================== */
        const MAX_TENTATIVAS = 3;
        const JANELA_TEMPO = 40;   // segundos para contar tentativas
        const TEMPO_BLOQUEIO = 30; // segundos de bloqueio

        const form = document.querySelector("form");
        const btn = document.getElementById("btn-login");
        const msg = document.getElementById("login-msg");

        if (!form || !btn || !msg) return;

        const agora = () => Math.floor(Date.now() / 1000);

        let tentativas = JSON.parse(
            localStorage.getItem("login_timestamps") || "[]"
        );
        let bloqueioAte = parseInt(
            localStorage.getItem("login_bloqueio") || "0"
        );

        // Limpa tentativas antigas
        tentativas = tentativas.filter(t => agora() - t <= JANELA_TEMPO);
        localStorage.setItem("login_timestamps", JSON.stringify(tentativas));

        // Se ainda estiver bloqueado ao carregar a página
        if (agora() < bloqueioAte) {
            ativarBloqueio(bloqueioAte - agora());
        }

        form.addEventListener("submit", () => {
            tentativas.push(agora());

            tentativas = tentativas.filter(t => agora() - t <= JANELA_TEMPO);
            localStorage.setItem("login_timestamps", JSON.stringify(tentativas));

            if (tentativas.length >= MAX_TENTATIVAS) {
            const fim = agora() + TEMPO_BLOQUEIO;
            localStorage.setItem("login_bloqueio", fim);
            ativarBloqueio(TEMPO_BLOQUEIO);
            }
        });

        function ativarBloqueio(tempoInicial) {
            btn.disabled = true;
            msg.style.display = "block";

            let tempo = tempoInicial;

            const timer = setInterval(() => {
            msg.textContent =
                `Muitas tentativas. Aguarde ${tempo}s para tentar novamente.`;
            tempo--;

            if (tempo < 0) {
                clearInterval(timer);
                btn.disabled = false;
                msg.style.display = "none";
                localStorage.removeItem("login_bloqueio");
            }
            }, 1000);
        }
    })();
    </script>





    <footer class="site-footer">
        <div class="footer-content">
            <span>
                Desenvolvido por <strong>Silvanio Junior</strong><br>
                © 2026 — Todos os direitos reservados
            </span>

            <div class="footer-links">
                <a href="https://www.linkedin.com/in/silvanio-mota-analista-de-dados?original_referer=" target="_blank" title="LinkedIn" class="linkedin-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4.98 3.5C4.98 5 3.9 6.1 2.4 6.1S-.18 5-.18 3.5 1.08.9 2.4.9s2.58 1.1 2.58 2.6zM.24 8.1h4.32V24H.24V8.1zM8.88 8.1h4.14v2.2h.06c.58-1.1 2-2.26 4.12-2.26 4.4 0 5.22 2.9 5.22 6.66V24h-4.32v-7.8c0-1.86-.04-4.26-2.6-4.26-2.6 0-3 2.04-3 4.14V24H8.88V8.1z"/>
                    </svg>
                </a>
            </div>
        </div>
    </footer>



</body>
</html>

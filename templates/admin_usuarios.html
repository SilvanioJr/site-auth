<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuários</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="dashboard-body">

<div class="dashboard-container">

    <h2>Cadastrar novo usuário</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="login-alert {{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- FORM CADASTRO -->
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <input type="hidden" name="acao" value="criar">

        <label>Usuário</label>
        <input type="text" name="username" required>

        <label>Senha</label>
        <input type="password" name="password" required>

        <label>Tipo de acesso</label>
        <select name="role">
            <option value="user">Usuário</option>
            <option value="admin">Admin</option>
        </select>

        <button type="submit">Cadastrar</button>
    </form>

    <hr style="margin: 40px 0; opacity: 0.3;">

    <h2>Redefinir senha de usuário</h2>

    <!-- FORM TROCA DE SENHA -->
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <label>Usuário</label>
        <select name="user_id" required>
            {% for user in usuarios %}
                <option value="{{ user.Id }}">
                    {{ user.username }}
                </option>
            {% endfor %}
        </select>

        <label>Nova senha</label>
        <input 
            type="password" 
            name="nova_senha" 
            placeholder="Digite a nova senha"
            required
        >

        <button type="submit" name="acao" value="trocar_senha">
            Redefinir senha
        </button>
    </form>

    <hr style="margin: 40px 0; opacity: 0.3;">

<h2>Excluir usuário</h2>

<form method="POST"
      onsubmit="return confirm('Tem certeza que deseja excluir este usuário? Essa ação não pode ser desfeita.')">

    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">


    <label>Usuário</label>
    <select name="user_id" required>
        {% for user in usuarios %}
            <option value="{{ user.Id }}">
                {{ user.username }}
            </option>
        {% endfor %}
    </select>

    <button 
        type="submit" 
        name="acao" 
        value="excluir_usuario"
        style="background: #7a1e1e; margin-top: 10px;"
    >
        Excluir usuário
    </button>
</form>


    <a href="{{ url_for('dashboard') }}" class="back-link">Voltar</a>

</div>

</body>
</html>
